{% extends 'landing_base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
<!-- Page Preloder -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Offcanvas Menu Begin -->
<div class="offcanvas-menu-overlay"></div>
<div class="offcanvas-menu-wrapper">
    <div class="offcanvas__option">
        <div class="offcanvas__links">
            <a href="#">Sign in</a>
            <a href="#">FAQs</a>
        </div>
        <div class="offcanvas__top__hover">
            <span>Usd <i class="arrow_carrot-down"></i></span>
            <ul>
                <li>USD</li>
                <li>EUR</li>
                <li>USD</li>
            </ul>
        </div>
    </div>
    <div class="offcanvas__nav__option">
        <a href="#" class="search-switch"><img src="/static/frontend/img/icon/search.png" alt=""></a>
        <a href="#"><img src="/static/frontend/img/icon/heart.png" alt=""></a>
        <a href="#"><img src="/static/frontend/img/icon/cart.png" alt=""> <span>0</span></a>
        <div class="price">$0.00</div>
    </div>
    <div id="mobile-menu-wrap"></div>
    <div class="offcanvas__text">
        <p>Free shipping, 30-day return or refund guarantee.</p>
    </div>
</div>
<!-- Offcanvas Menu End -->



<!-- Hero Section Begin -->
<section class="hero">
    <div class="hero__slider owl-carousel">
        {% for banner in banners %}
        <div class="hero__items set-bg" data-setbg="{{ banner.photo.url }}">
            <div class="container">
                <div class="row">
                    <div class="col-xl-5 col-lg-7 col-md-8">
                        <div class="hero__text">
                           <h6 style="font-size: 30px; font-weight: 700;">
    {{ banner.title }}
</h6>

                            <h2 style="font-size: 16px; line-height: 1.4; color:rgb(85, 81, 81)">{{ banner.description }}</h2>
                        {% if banner.product %}
    <a href="{% url 'product_detail' banner.product.id %}" class="primary-btn">
        Shop now <span class="arrow_right"></span>
    </a>
{% else %}
    <a href="{% url 'shop_all' %}" class="primary-btn">
        Shop now <span class="arrow_right"></span>
    </a>
{% endif %}

                            <div class="hero__social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-pinterest"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>


<!-- Hero Section End -->

<!-- Banner Section Begin -->
<style>
/* Smaller banner text */
.banner__item__text h2 {
    font-size: 18px; /* smaller title */
}

.banner__item__text a {
    font-size: 14px; /* smaller "Shop now" link */
    padding: -1px 10px; /* optional: smaller padding */
}
.heart-outlined {
    color: #ffffff;
    text-shadow: 
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
}
</style>

<section class="featured-categories py-5">
    <div class="container">
        <h3 class="section-title mb-4 text-center fw-bold">Featured Products</h3>
        <div class="row g-3">
            {% for product in featured_products %}
            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <a href="{% url 'product_detail' product.pk %}" class="text-decoration-none">
                    <div class="card border-0 shadow-sm overflow-hidden h-100 product-card">
                        <div class="position-relative overflow-hidden" style="height: 200px;">
                            <img src="{{ product.photo.url }}" 
                                 alt="{{ product.title }}" 
                                 class="w-100 h-100 object-fit-cover transition">
                            <div class="overlay d-flex align-items-center justify-content-center">
                                <span class="text-white fw-bold"></span>
                            </div>
                        </div>
                        <div class="card-body p-2 text-center bg-light">
                            <h6 class="card-title mb-0 text-dark small">{{ product.title }}</h6>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<style>
.product-card {
    transition: transform 0.3s, box-shadow 0.3s;
}
.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.object-fit-cover {
    object-fit: cover;
    object-position: center;
}

/* Optional overlay effect */
.overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.3);
    opacity: 0;
    transition: opacity 0.3s;
}
.product-card:hover .overlay {
    opacity: 1;
}
</style>


<!-- Banner Section End -->

<!-- Product Section -->
<section class="product spad">
    <div class="container">
        <!-- Heading -->
        <div class="row mb-4">
            <div class="col-lg-12">
                <h3 class="section-title mb-1"><b>Our Products</b></h3>
            </div>
        </div>

        <div class="row product__filter position-relative">
            {% for product in products|slice:":8" %}
            <div class="col-lg-3 col-md-6 col-sm-6 mix
                        {% if product.is_new %}new-arrivals{% elif product.is_sale %}hot-sales{% endif %}">
                <div class="product__item {% if product.is_sale %}sale{% endif %}">

                    <!-- Image container -->
                    <div class="product__item__pic set-bg" 
                         data-setbg="{% if product.photo %}{{ product.photo.url }}{% else %}{% static 'frontend/img/product/placeholder.jpg' %}{% endif %}">
                        {% if product.is_new %}<span class="label">New</span>{% elif product.is_sale %}<span class="label">Sale</span>{% endif %}

                        <!-- Hover icons -->
                        <ul class="product__hover">
                            <li>
                                {% if user.is_authenticated %}
                                <a href="#" class="wishlist-btn" data-product-id="{{ product.pk }}">
                                    {% if product.pk in wishlisted_ids %}
                                        <i class="fa fa-heart" style="color: #ff0000; font-size: 18px;"></i>
                                    {% else %}
                                        <i class="fa fa-heart heart-outlined" style="font-size: 18px;"></i>
                                    {% endif %}
                                </a>
                                {% else %}
                                <a href="{% url 'login' %}">
                                    <i class="fa fa-heart heart-outlined" style="font-size: 18px;"></i>
                                </a>
                                {% endif %}
                            </li>
                            <li><a href="#"><img src="{% static 'frontend/img/icon/compare.png' %}" alt=""><span>Compare</span></a></li>
                            <li><a href="#"><img src="{% static 'frontend/img/icon/search.png' %}" alt=""></a></li>
                        </ul>

                        <!-- Clickable overlay for image -->
                        <a href="{% url 'product_detail' product.pk %}" class="image-link"></a>
                    </div>

                    <!-- Product info below image -->
                    <div class="product__item__text">
                        <h6>{{ product.title }}</h6>
                        <a href="{% url 'product_detail' product.pk %}" class="add-cart">
                            {% if user.is_authenticated %}+ Add To Cart{% else %}Login to Add{% endif %}
                        </a>

                        <div class="rating">
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                        </div>

                        <h5>â‚¹{{ product.price|floatformat:2 }}</h5>

                        <div class="product__color__select">
                            {% if product.color_data %}
                                {% for color in product.color_data %}
                                    <label style="background: {{ color.code }};"
                                           for="pc-{{ product.id }}-{{ forloop.counter }}">
                                        <input type="radio" id="pc-{{ product.id }}-{{ forloop.counter }}" 
                                               name="color-{{ product.id }}" value="{{ color.name }}" hidden>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label for="pc-{{ product.id }}-1">
                                    <input type="radio" id="pc-{{ product.id }}-1" hidden>
                                </label>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% if total_products_count > 8 %}
            <div class="col-12 d-flex justify-content-end mt-2">
                <a href="{% url 'shop_all' %}" class="read-more-link">Read More</a>
            </div>
            {% endif %}
        </div>
    </div>
</section>



<!-- CSS -->
<style>
.read-more-link {
    text-decoration: underline;
    color: #000; /* default black */
    font-weight: 500;
    transition: color 0.3s;
}

.read-more-link:hover {
    color: #0a3d62; /* dark blue on hover */
    text-decoration: underline;
}
.product__item__pic {
    position: relative;
}

/* Hover icons above everything */
.product__hover {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 2;
}

/* Full-size invisible link for image click */
.image-link {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* below hover icons */
}
</style>

<!-- Product Section End -->

<!-- Categories Section Begin -->
<section class="categories spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="categories__text">
                    <h2>Clothings Hot <br /> <span>Shoe Collection</span> <br /> Accessories</h2>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="categories__hot__deal">
                    <img src="/static/frontend/img/product-sale.png" alt="">
                    <div class="hot__deal__sticker">
                        <span>Sale Of</span>
                        <h5>$29.99</h5>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 offset-lg-1">
                <div class="categories__deal__countdown">
                    <span>Deal Of The Week</span>
                    <h2>Multi-pocket Chest Bag Black</h2>
                    <div class="categories__deal__countdown__timer" id="countdown">
                        <div class="cd-item">
                            <span>3</span>
                            <p>Days</p>
                        </div>
                        <div class="cd-item">
                            <span>1</span>
                            <p>Hours</p>
                        </div>
                        <div class="cd-item">
                            <span>50</span>
                            <p>Minutes</p>
                        </div>
                        <div class="cd-item">
                            <span>18</span>
                            <p>Seconds</p>
                        </div>
                    </div>
                    <a href="#" class="primary-btn">Shop now</a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Categories Section End -->

<!-- Search Begin -->
<div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch">+</div>
        <form class="search-model-form">
            <input type="text" id="search-input" placeholder="Search here.....">
        </form>
    </div>
</div>
<!-- Search End -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('.wishlist-btn').on('click', function(e) {
        e.preventDefault();
        var btn = $(this);
        var productId = btn.data('product-id');
        var csrftoken = '{{ csrf_token }}';

        $.ajax({
            url: '/toggle-wishlist/' + productId + '/',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': csrftoken
            },
            dataType: 'json',
            success: function(response) {
                if (response.status === 'ok') {
                    var heartIcon = btn.find('i');

                    if (response.is_added) {
                        heartIcon.removeClass('heart-outlined').css('color', '#ff0000');
                    } else {
                        heartIcon.addClass('heart-outlined').css('color', '');
                    }

                    // Update badge
                    updateWishlistBadge(response.wishlist_count);
                }
            },
            error: function(xhr) {
                console.log('Error:', xhr.responseText);
                alert('Something went wrong. Please try again.');
            }
        });
    });

    function updateWishlistBadge(count) {
        var badge = $('.wishlist-count-badge');
        if (count > 0) {
            if (badge.length > 0) {
                badge.text(count).show();
            } else {
                var heartLink = $('a[href*="wishlist"]').first();
                heartLink.css('position', 'relative');
                heartLink.append('<span class="badge bg-danger rounded-circle wishlist-count-badge" style="position: absolute; top: -5px; right: -5px; font-size: 10px; min-width: 18px; height: 18px; padding: 2px 5px; line-height: 14px;">' + count + '</span>');
            }
        } else {
            badge.hide();
        }
    }
});
</script>

{% endblock %}