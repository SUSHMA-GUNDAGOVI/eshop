{% extends 'landing_base.html' %}
{% load static %}
{% load custom_filters %} 

{% block title %}Home{% endblock %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<div class="offcanvas-menu-overlay"></div>
<div class="offcanvas-menu-wrapper">
    <div class="offcanvas__option">
        <div class="offcanvas__links">
            <a href="#">Sign in</a>
            <a href="#">FAQs</a>
        </div>
        <div class="offcanvas_top_hover">
            <span>Usd <i class="arrow_carrot-down"></i></span>
            <ul>
                <li>USD</li>
                <li>EUR</li>
                <li>USD</li>
            </ul>
        </div>
    </div>
    <div class="offcanvas_nav_option">
        <a href="#" class="search-switch"><img src="/static/frontend/img/icon/search.png" alt=""></a>
        <a href="#"><img src="/static/frontend/img/icon/heart.png" alt=""></a>
        <a href="#"><img src="/static/frontend/img/icon/cart.png" alt=""> <span>0</span></a>
        <div class="price">$0.00</div>
    </div>
    <div id="mobile-menu-wrap"></div>
    <div class="offcanvas__text">
        <p>Free shipping, 30-day return or refund guarantee.</p>
    </div>
</div>
<section class="hero">
    <div class="hero__slider owl-carousel">
        {% for banner in banners %}
        <div class="hero__items set-bg" data-setbg="{{ banner.photo.url }}">
            <div class="container">
                <div class="row">
                    <div class="col-xl-5 col-lg-7 col-md-8">
                        <div class="hero__text" data-aos="fade-right" data-aos-duration="1000" data-aos-delay="200">
                           <h6 style="font-size: 30px; font-weight: 700;">
    {{ banner.title }}
</h6>

                            <h2 style="font-size: 16px; line-height: 1.4; color:rgb(85, 81, 81)">{{ banner.description }}</h2>
                        {% if banner.product %}
    <a href="{% url 'product_detail' banner.product.id %}" class="primary-btn">
        Shop now <span class="arrow_right"></span>
    </a>
{% else %}
    <a href="{% url 'shop_all' %}" class="primary-btn">
        Shop now <span class="arrow_right"></span>
    </a>
{% endif %}

                            <div class="hero__social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-pinterest"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<style>
    /* Your original CSS styles for responsiveness, animations, etc. (Keep them) */
    @media only screen and (min-width: 1200px) {
    .container {
        max-width: 1090px;
    }
}
.heart-outlined {
    color: #ffffff;
    text-shadow: 
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
}

/* Animation styles */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}

/* Product hover animations (Keep them) */
.product__item {
    transition: all 0.3s ease;
    overflow: hidden;
}

.product__item:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
}

.product_item_pic {
    transition: all 0.5s ease;
    position: relative;
}

.product_item:hover .productitem_pic {
    transform: scale(1.05);
}

.product__hover {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
}

.product_item:hover .product_hover {
    opacity: 1;
    transform: translateY(0);
}

.product_item_text {
    transition: all 0.3s ease;
}

.product_item:hover .productitem_text {
    background-color: #f9f9f9;
}

.add-cart {
    transition: all 0.3s ease;
}

.add-cart:hover {
    background-color: #000;
    color: #fff;
}

/* Banner animations */
.banner__item {
    overflow: hidden;
    position: relative;
}

.banner_item_pic {
    transition: all 0.5s ease;
}

.banner_item:hover .banneritem_pic {
    transform: scale(1.1);
}

.banner_item_text {
    transition: all 0.3s ease;
}

.banner_item:hover .banneritem_text {
    background-color: rgba(255,255,255,0.9);
}

/* Hero section animations */
.hero__text h6 {
    animation: fadeInUp 1s ease forwards;
}

.hero__text h2 {
    animation: fadeInUp 1s ease 0.3s forwards;
    opacity: 0;
}

.hero__text .primary-btn {
    animation: fadeInUp 1s ease 0.6s forwards;
    opacity: 0;
}

.hero__social {
    animation: fadeInUp 1s ease 0.9s forwards;
    opacity: 0;
}

/* Read more link animation */
.read-more-link {
    position: relative;
    transition: all 0.3s ease;
}

.read-more-link:after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -5px;
    left: 0;
    background-color: #0a3d62;
    transition: width 0.3s ease;
}

.read-more-link:hover:after {
    width: 100%;
}

/* Wishlist heart animation */
.wishlist-btn i {
    transition: all 0.3s ease;
}

.wishlist-btn:hover i {
    animation: pulse 0.5s ease;
}

/* Countdown animation */
.cd-item {
    animation: bounce 2s infinite;
}

.cd-item:nth-child(2) {
    animation-delay: 0.2s;
}

.cd-item:nth-child(3) {
    animation-delay: 0.4s;
}

.cd-item:nth-child(4) {
    animation-delay: 0.6s;
}

/* NEW FEATURE PRODUCT CARD STYLES */
.featured-card {
    display: flex;
    flex-direction: column;
    margin-bottom: 25px;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
}

.featured-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.featured-card-image {
    height: 200px; /* Fixed height for image area */
    background-size: cover;
    background-position: center;
    position: relative;
    overflow: hidden;
}

.featured-card-body {
    padding: 15px;
    text-align: center;
    flex-grow: 1;
}

.featured-card-body h6 {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 5px;
    line-height: 1.3;
}

.featured-card-price h5 {
    color: #e53637;
    font-weight: 700;
    margin: 5px 0 10px;
}

.featured-card-actions {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.featured-card-actions .btn {
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

.featured-card-actions .primary-btn {
    background: #341f1f;
    color: white;
    border: none;
}
.featured-card-actions .primary-btn:hover {
    background: #c02d2e;
}

.featured-card-actions .secondary-btn {
    background: white;
    color: #2c3e50;
    border: 1px solid #e9ecef;
}
.featured-card-actions .secondary-btn:hover {
    background: #f1f1f1;
}

.featured-card-label {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #000;
    color: white;
    padding: 3px 8px;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 3px;
    z-index: 10;
}
.featured-card-label.sale {
    background: #ff0000;
}
</style>

<section class="product spad mt-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-lg-12">
                <h3 class="section-title mb-1" data-aos="fade-up"><b>Feature Products</b></h3>
            </div>
        </div>

        <div class="row position-relative">
            {% for product in products|slice:":4" %}
            <div class="col-lg-3 col-md-6 col-sm-6"
                 data-aos="fade-up" data-aos-duration="800" data-aos-delay="{% widthratio forloop.counter0 1 100 %}">
                
                <div class="featured-card">
                    
                    <div class="featured-card-image"
                         style="background-image: url('{% if product.photo %}{{ product.photo.url }}{% else %}{% static 'frontend/img/product/placeholder.jpg' %}{% endif %}');">
                        
                        {% if product.is_new %}<span class="featured-card-label">New</span>
                        {% elif product.is_sale %}<span class="featured-card-label sale">Sale</span>
                        {% endif %}

                        <div class="product__hover" style="position: absolute;top: 10px; right: 87%; opacity: 1; transform: none;">
                            <ul style="padding: 0; margin: 0; list-style: none;">
                                <li>
                                    {% if user.is_authenticated %}
                                    <a href="#" class="wishlist-btn" data-product-id="{{ product.pk }}">
                                        {% if product.pk in wishlisted_ids %}
                                            <i class="fa fa-heart" style="color: #ff0000; font-size: 18px; text-shadow: none;"></i>
                                        {% else %}
                                            <i class="fa fa-heart heart-outlined" style="font-size: 18px; color: #fff;"></i>
                                        {% endif %}
                                    </a>
                                    {% else %}
                                    <a href="{% url 'login' %}">
                                        <i class="fa fa-heart heart-outlined" style="font-size: 18px; color: #fff;"></i>
                                    </a>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                        
                        <a href="{% url 'product_detail' product.pk %}" class="image-link" style="z-index: 1;"></a>
                    </div>
                    
                    <div class="featured-card-body">
                        <h6>{{ product.title }}</h6>
                        
                        <div class="featured-card-price">
                            <h5>₹{{ product.price|floatformat:2 }}</h5>
                        </div>
                        
                        <div class="featured-card-actions">
                            <a href="{% url 'product_detail' product.pk %}" class="primary-btn">
                                <i class="fa fa-shopping-cart"></i> View
                            </a>
                        </div>
                    </div>
                </div>

            </div>
            {% endfor %}

            {% if total_products_count > 4 %}
            <div class="col-12 d-flex justify-content-end mt-2" data-aos="fade-up" data-aos-delay="500">
                <a href="{% url 'shop_all' %}" class="read-more-link">Read More</a>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Product Section -->
<section class="product spad">
    <div class="container">
        <!-- Heading -->
        <div class="row mb-4">
            <div class="col-lg-12">
                <h3 class="section-title mb-1"><b>Our Products</b></h3>
            </div>
        </div>

        <div class="row product__filter position-relative">
            {% for product in products|slice:":8" %}
<div class="col-lg-3 col-md-6 col-sm-6 mix
            {% if product.is_new %}new-arrivals{% elif product.is_sale %}hot-sales{% endif %}"
     data-aos="fade-up" 
     data-aos-duration="800" 
     data-aos-delay="{% widthratio forloop.counter0 1 100 %}">
                <div class="product__item {% if product.is_sale %}sale{% endif %}">

                    <!-- Image container -->
                    <div class="product__item__pic set-bg" 
                         data-setbg="{% if product.photo %}{{ product.photo.url }}{% else %}{% static 'frontend/img/product/placeholder.jpg' %}{% endif %}">
                        {% if product.is_new %}<span class="label">New</span>{% elif product.is_sale %}<span class="label">Sale</span>{% endif %}

                        <!-- Hover icons -->
                        <ul class="product__hover">
                            <li>
                                {% if user.is_authenticated %}
                                <a href="#" class="wishlist-btn" data-product-id="{{ product.pk }}">
                                    {% if product.pk in wishlisted_ids %}
                                        <i class="fa fa-heart" style="color: #ff0000; font-size: 18px;"></i>
                                    {% else %}
                                        <i class="fa fa-heart heart-outlined" style="font-size: 18px;"></i>
                                    {% endif %}
                                </a>
                                {% else %}
                                <a href="{% url 'login' %}">
                                    <i class="fa fa-heart heart-outlined" style="font-size: 18px;"></i>
                                </a>
                                {% endif %}
                            </li>
                            <li><a href="#"><img src="{% static 'frontend/img/icon/compare.png' %}" alt=""><span>Compare</span></a></li>
                            <li><a href="#"><img src="{% static 'frontend/img/icon/search.png' %}" alt=""></a></li>
                        </ul>

                        <!-- Clickable overlay for image -->
                        <a href="{% url 'product_detail' product.pk %}" class="image-link"></a>
                    </div>

                    <!-- Product info below image -->
                    <div class="product__item__text">
                        <h6>{{ product.title }}</h6>
                        <a href="{% url 'product_detail' product.pk %}" class="add-cart">
                            {% if user.is_authenticated %}+ Add To Cart{% else %}Login to Add{% endif %}
                        </a>

                        <div class="rating">
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                            <i class="fa fa-star-o"></i>
                        </div>

                        <h5>₹{{ product.price|floatformat:2 }}</h5>

                        <div class="product__color__select">
                            {% if product.color_data %}
                                {% for color in product.color_data %}
                                    <label style="background: {{ color.code }};"
                                           for="pc-{{ product.id }}-{{ forloop.counter }}">
                                        <input type="radio" id="pc-{{ product.id }}-{{ forloop.counter }}" 
                                               name="color-{{ product.id }}" value="{{ color.name }}" hidden>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label for="pc-{{ product.id }}-1">
                                    <input type="radio" id="pc-{{ product.id }}-1" hidden>
                                </label>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% if total_products_count > 8 %}
            <div class="col-12 d-flex justify-content-end mt-2">
                <a href="{% url 'shop_all' %}" class="read-more-link">Read More</a>
            </div>
            {% endif %}
        </div>
    </div>
</section>
<section class="categories spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3" data-aos="fade-right" data-aos-duration="800">
                <div class="categories__text">
                    <h2>Clothings Hot <br /> <span>Shoe Collection</span> <br /> Accessories</h2>
                </div>
            </div>
            <div class="col-lg-4" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                <div class="categories_hot_deal">
                    <img src="/static/frontend/img/product-sale.png" alt="">
                    <div class="hot_deal_sticker">
                        <span>Sale Of</span>
                        <h5>$29.99</h5>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 offset-lg-1" data-aos="fade-left" data-aos-duration="800" data-aos-delay="400">
                <div class="categories_deal_countdown">
                    <span>Deal Of The Week</span>
                    <h2>Multi-pocket Chest Bag Black</h2>
                    <div class="categories_dealcountdown_timer" id="countdown">
                        <div class="cd-item">
                            <span>3</span>
                            <p>Days</p>
                        </div>
                        <div class="cd-item">
                            <span>1</span>
                            <p>Hours</p>
                        </div>
                        <div class="cd-item">
                            <span>50</span>
                            <p>Minutes</p>
                        </div>
                        <div class="cd-item">
                            <span>18</span>
                            <p>Seconds</p>
                        </div>
                    </div>
                    <a href="#" class="primary-btn">Shop now</a>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="instagram spad" style="overflow: hidden;">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="instagram__pic">
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-1.jpg" data-aos="zoom-in" data-aos-duration="800"></div>
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-2.jpg" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="100"></div>
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-3.jpg" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="200"></div>
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-4.jpg" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="300"></div>
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-5.jpg" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="400"></div>
                    <div class="instagram_pic_item set-bg"
                         data-setbg="/static/frontend/img/instagram/instagram-6.jpg" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="500"></div>
                </div>
            </div>
            <div class="col-lg-4" style="overflow: hidden;">
                <div class="instagram__text" data-aos="fade-left" data-aos-duration="800" data-aos-delay="300">
                    <h2>Instagram</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore magna aliqua.</p>
                    <h3>#Male_Fashion</h3>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="latest spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title" data-aos="fade-up">
                    <span>Latest News</span>
                    <h2>Fashion New Trends</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-6" data-aos="fade-up" data-aos-duration="800">
                <div class="blog__item">
                    <div class="blog_item_pic set-bg" data-setbg="/static/frontend/img/blog/blog-1.jpg"></div>
                    <div class="blog_item_text">
                        <span><img src="/static/frontend/img/icon/calendar.png" alt=""> 16 February 2020</span>
                        <h5>What Curling Irons Are The Best Ones</h5>
                        <a href="#">Read More</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                <div class="blog__item">
                    <div class="blog_item_pic set-bg" data-setbg="/static/frontend/img/blog/blog-2.jpg"></div>
                    <div class="blog_item_text">
                        <span><img src="/static/frontend/img/icon/calendar.png" alt=""> 21 February 2020</span>
                        <h5>Eternity Bands Do Last Forever</h5>
                        <a href="#">Read More</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
                <div class="blog__item">
                    <div class="blog_item_pic set-bg" data-setbg="/static/frontend/img/blog/blog-3.jpg"></div>
                    <div class="blog_item_text">
                        <span><img src="/static/frontend/img/icon/calendar.png" alt=""> 28 February 2020</span>
                        <h5>The Health Benefits Of Sunglasses</h5>
                        <a href="#">Read More</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch">+</div>
        <form class="search-model-form">
            <input type="text" id="search-input" placeholder="Search here.....">
        </form>
    </div>
</div>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Initialize AOS (Animate On Scroll)
AOS.init({
    duration: 800,
    easing: 'ease-in-out',
    once: true, 
    mirror: false
});

$(document).ready(function() {
    // AJAX Wishlist Toggle (Keep this)
    $('.wishlist-btn').on('click', function(e) {
        e.preventDefault();
        var btn = $(this);
        var productId = btn.data('product-id');
        var csrftoken = '{{ csrf_token }}';

        $.ajax({
            url: '/toggle-wishlist/' + productId + '/',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': csrftoken
            },
            dataType: 'json',
            success: function(response) {
                if (response.status === 'ok') {
                    var heartIcon = btn.find('i');
                    var isAdded = response.is_added;

                    // Update Feature Card Icon
                    if (isAdded) {
                        heartIcon.removeClass('heart-outlined').css({'color': '#ff0000', 'text-shadow': 'none'});
                    } else {
                        // Check parent class for correct style removal
                        if(btn.closest('.featured-card').length) {
                             heartIcon.addClass('heart-outlined').css({'color': '#fff', 'text-shadow': 'none'});
                        } else {
                             heartIcon.addClass('heart-outlined').css('color', '');
                        }
                    }

                    // Animation for both product types
                    heartIcon.css('transform', 'scale(1.3)');
                    setTimeout(function() {
                        heartIcon.css('transform', 'scale(1)');
                    }, 300);

                    // Update badge
                    updateWishlistBadge(response.wishlist_count);
                }
            },
            error: function(xhr) {
                console.log('Error:', xhr.responseText);
                alert('Something went wrong. Please try again.');
            }
        });
    });

    // Wishlist Badge Logic (Keep this)
    function updateWishlistBadge(count) {
        var badge = $('.wishlist-count-badge');
        if (count > 0) {
            if (badge.length > 0) {
                badge.text(count).show();
            } else {
                var heartLink = $('a[href*="wishlist"]').first();
                heartLink.css('position', 'relative');
                heartLink.append('<span class="badge bg-danger rounded-circle wishlist-count-badge" style="position: absolute; top: -5px; right: -5px; font-size: 10px; min-width: 18px; height: 18px; padding: 2px 5px; line-height: 14px;">' + count + '</span>');
            }
        } else {
            badge.hide();
        }
    }
});
</script>

{% endblock %}
