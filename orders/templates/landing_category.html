<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders by Category</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .single-banner {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .single-banner:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .single-banner img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        .single-banner .content {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 15px;
            background: rgba(0,0,0,0.5);
            color: white;
            text-align: center;
        }
        .single-banner .content h3 {
            margin: 0 0 10px 0;
            font-size: 1.25rem;
        }
        .single-banner .content a {
            text-decoration: none;
            color: #ffc107;
            font-weight: bold;
            padding: 5px 15px;
            border: 1px solid #ffc107;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .single-banner .content a:hover {
            background: #ffc107;
            color: #000;
        }
    </style>
</head>
<body>

<div class="container my-5">
    <h2 class="text-center mb-4 fw-bold">üì¶ Main Categories</h2>
    <div id="category-banner" class="row g-4"></div>

    <!-- Subcategory section hidden initially -->
    <div id="subcategory-section" style="display:none;">
        <h2 class="text-center mt-5 mb-4 fw-bold">üóÇÔ∏è Subcategories</h2>
        <div id="subcategory-banner" class="row g-4"></div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const mainContainer = document.getElementById("category-banner");
    const subContainer = document.getElementById("subcategory-banner");
    const subSection = document.getElementById("subcategory-section");

    // Load main categories
    fetch("/orders/category/")
        .then(res => res.json())
        .then(data => {
            if (!data || data.length === 0) {
                mainContainer.innerHTML = `<p class="text-center text-muted">No categories found.</p>`;
                return;
            }

            data.forEach(category => {
                if (!category.photo_url) return; // skip if no photo

                const col = document.createElement("div");
                col.className = "col-12 col-md-6 col-lg-4";

                col.innerHTML = `
                    <div class="single-banner" data-id="${category.id}">
                        <img src="${category.photo_url}" alt="${category.title}" 
                             onerror="this.src='https://via.placeholder.com/600x370?text=Image+Error'">
                        <div class="content">
                            <h3>${category.title}</h3>
                            <a href="javascript:void(0);" class="show-subcategory">Discover Now</a>
                        </div>
                    </div>
                `;
                mainContainer.appendChild(col);
            });

            // Add click listeners
            document.querySelectorAll(".show-subcategory").forEach(link => {
                link.addEventListener("click", function(e) {
                    const parentDiv = e.target.closest(".single-banner");
                    const categoryId = parentDiv.getAttribute("data-id");
                    fetchSubcategories(categoryId);
                });
            });
        })
        .catch(err => {
            console.error("Error fetching categories:", err);
            mainContainer.innerHTML = `<p class="text-center text-danger">Error loading categories.</p>`;
        });

    function fetchSubcategories(categoryId) {
        console.log("Fetching subcategories for:", categoryId);
        fetch(`/orders/subcategory/${categoryId}/`)
            .then(res => res.json())
            .then(subcats => {
                subContainer.innerHTML = ""; // clear previous

                if (!subcats || subcats.length === 0) {
                    subContainer.innerHTML = `<p class="text-center text-muted">No subcategories found.</p>`;
                    subSection.style.display = "block"; // show section even if empty
                    return;
                }

                subcats.forEach(sub => {
                    if (!sub.photo_url) return; // skip if no photo

                    const col = document.createElement("div");
                    col.className = "col-12 col-md-6 col-lg-4";

                    col.innerHTML = `
                        <div class="single-banner">
                            <img src="${sub.photo_url}" alt="${sub.title}" 
                                 onerror="this.src='https://via.placeholder.com/600x370?text=Image+Error'">
                            <div class="content">
                                <h3>${sub.title}</h3>
                                <a href="/products/category/${sub.id}/">Discover Now</a>
                            </div>
                        </div>
                    `;
                    subContainer.appendChild(col);
                });

                subSection.style.display = "block"; // show subcategory section
            })
            .catch(err => {
                console.error("Error fetching subcategories:", err);
                subContainer.innerHTML = `<p class="text-center text-danger">Error loading subcategories.</p>`;
                subSection.style.display = "block";
            });
    }
});
</script>

</body>
</html>
